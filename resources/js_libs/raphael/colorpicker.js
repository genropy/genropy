/*
 * Color Picker 0.1.0 - Raphael plugin
 *
 * Copyright (c) 2010 Dmitry Baranovskiy (http://raphaeljs.com)
 * Based on Color Wheel (http://jweir.github.com/colorwheel) by John Weir (http://famedriver.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
(function(a){a.colorpicker=function(h,l,j,k,i){return new b(h,l,j,k,i);};a.fn.colorPickerIcon=function(h,o,m){var k=f*m*2/Math.min(m/8,4);var j=f/2-f*2/k*1.5,n=["M",h,o-m,"A",m,m,0,0,1,m*Math.cos(j)+h,o-m*Math.sin(j),"L",h,o,"z"].join();for(var l=0;l<k;l++){this.path(n).attr({stroke:"none",fill:"hsb("+(k-l)*(255/k)+", 255, 255)",rotation:[90+(360/k)*l,h,o]});}return this.circle(h,o,m).attr({fill:"r#fff-#fff","fill-opacity":0,"stroke-width":Math.round(m*0.03),stroke:"#fff"});};var f=Math.PI;function g(h,i){return(h<0)*180+Math.atan(-i/-h)*180/f;}var e=document,d=window,c=(function(){if(e.addEventListener){return function(l,j,i,h){var k=function(m){return i.call(h,m);};l.addEventListener(j,k,false);return function(){l.removeEventListener(j,k,false);return true;};};}else{if(e.attachEvent){return function(m,k,j,i){var l=function(n){return j.call(i,n||d.event);};m.attachEvent("on"+k,l);var h=function(){m.detachEvent("on"+k,l);return true;};return h;};}}})(),b=function(q,o,E,j,i){E=E||200;var p=3*E/200,v=E/200,w=1.6180339887,K=E/20,n=E/2,C=2*E/200,F=E+K*2+C*3,z=this,u=1,k=1,G=1,A=E-(K*4),D=i?a(i,E,F):a(q,o,E,F),l=A/6+K*2+C,m=A*2/3-C*2;v<1&&(v=1);p<1&&(p=1);D.colorPickerIcon(n,n,n-C);z.cursor=D.set();z.cursor.push(D.circle(n,n,K/2).attr({stroke:"#000",opacity:0.5,"stroke-width":p}));z.cursor.push(z.cursor[0].clone().attr({stroke:"#fff",opacity:1,"stroke-width":v}));z.disc=D.circle(n,n,n-C).attr({fill:"#000","fill-opacity":0,stroke:"none",cursor:"crosshair"});var J=z.disc.node.style;J.unselectable="on";J.MozUserSelect="none";J.WebkitUserSelect="none";var I=K*2+2;z.brect=D.rect(C+I/w/2,E+C*2,E-C*2-I/w,I-C*2).attr({stroke:"#fff",fill:"180-#fff-#000"});z.cursorb=D.set();z.cursorb.push(D.rect(E-C-I/w,E+C,~~(I/w),I,p).attr({stroke:"#000",opacity:0.5,"stroke-width":p}));z.cursorb.push(z.cursorb[0].clone().attr({stroke:"#fff",opacity:1,"stroke-width":v}));z.btop=z.brect.clone().attr({stroke:"#000",fill:"#000",opacity:0});J=z.btop.node.style;J.unselectable="on";J.MozUserSelect="none";J.WebkitUserSelect="none";z.bwidth=~~(I/w)/2;z.minx=C+z.bwidth;z.maxx=E-I/w-C+z.bwidth;z.H=z.S=z.B=1;z.padding=C;z.raphael=D;z.size2=n;z.size20=K;z.x=q;z.y=o;z.hson=c(z.disc.node,"mousedown",function(r){var h=e.documentElement.scrollTop||e.body.scrollTop,s=e.documentElement.scrollLeft||e.body.scrollLeft;this.hsOnTheMove=true;this.setHS(r.clientX+s-this.x,r.clientY+h-this.y);this.docmove=c(e,"mousemove",this.docOnMove,this);this.docup=c(e,"mouseup",this.docOnUp,this);},z);z.bon=c(z.btop.node,"mousedown",function(h){var r=e.documentElement.scrollLeft||e.body.scrollLeft;this.bOnTheMove=true;this.setB(h.clientX+r-this.x);this.docmove=c(e,"mousemove",this.docOnMove,this);this.docup=c(e,"mouseup",this.docOnUp,this);},z);z.winunload=c(d,"unload",function(){this.hson();this.bon();this.docmove&&this.docmove();this.docup&&this.docup();this.winunload();},z);z.color(j||"#fff");this.onchanged&&this.onchanged(this.color());};b.prototype.setB=function(h){h<this.minx&&(h=this.minx);h>this.maxx&&(h=this.maxx);this.cursorb.attr({x:h-this.bwidth});this.B=(h-this.minx)/(this.maxx-this.minx);this.onchange&&this.onchange(this.color());};b.prototype.setHS=function(h,n){var m=h-this.size2,l=n-this.size2,i=this.size2-this.size20/2-this.padding,k=g(m,l),j=k*f/180;isNaN(k)&&(k=0);if(m*m+l*l>i*i){h=i*Math.cos(j)+this.size2;n=i*Math.sin(j)+this.size2;}this.cursor.attr({cx:h,cy:n});this.H=(1-k/360)%1;this.S=Math.min((m*m+l*l)/i/i,1);this.brect.attr({fill:"180-hsb("+[this.H,this.S]+",1)-#000"});this.onchange&&this.onchange(this.color());};b.prototype.docOnMove=function(i){var h=e.documentElement.scrollTop||e.body.scrollTop,j=e.documentElement.scrollLeft||e.body.scrollLeft;if(this.hsOnTheMove){this.setHS(i.clientX+j-this.x,i.clientY+h-this.y);}if(this.bOnTheMove){this.setB(i.clientX+j-this.x);}i.preventDefault&&i.preventDefault();i.returnValue=false;return false;};b.prototype.docOnUp=function(h){this.hsOnTheMove=this.bOnTheMove=false;this.docmove();delete this.docmove;this.docup();delete this.docup;this.onchanged&&this.onchanged(this.color());h.preventDefault&&h.preventDefault();h.stopPropagation&&h.stopPropagation();h.returnValue=false;return false;};b.prototype.remove=function(){this.raphael.remove();this.color=function(){return false;};};b.prototype.color=function(i){if(i){i=a.getRGB(i);var l=i.hex;i=a.rgb2hsb(i.r,i.g,i.b);m=i.h*360;this.H=i.h;this.S=i.s;this.B=i.b;this.cursorb.attr({x:this.B*(this.maxx-this.minx)+this.minx-this.bwidth});this.brect.attr({fill:"180-hsb("+[this.H,this.S]+",1)-#000"});var m=(1-this.H)*360,k=m*f/180,j=(this.size2-this.size20/2-this.padding)*this.S,h=Math.cos(k)*j+this.size2,n=Math.sin(k)*j+this.size2;this.cursor.attr({cx:h,cy:n});return this;}else{return a.hsb2rgb(this.H,this.S,this.B).hex;}};})(window.Raphael);